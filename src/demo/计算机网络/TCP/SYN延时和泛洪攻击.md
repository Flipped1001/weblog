---
title: SYN延时和泛洪攻击
date: 2023-11-30
tags:
 - 计算机基础
 - 计算机网络
categories:
 - 计算机网络
---

<!-- more -->

### 什么是SYN攻击，如何避免SYN攻击？

​	攻击者在短时内向服务端发送大量的SYN报文，将服务端的**半连接队列占满**，使得服务器不能为正常用户服务

半连接队列（SYN队列）：收到SYN报文时，就会创建一个半连接对象，内核会把该链接放到SYN队列
全连接队列（Accept队列）：收到客户端的ACK报文时，内核从SYN队列取出一条半连接队列，创建一个全连接队列，然后添加到accept队列

**当 TCP 半连接队列满了，后续再在收到 SYN 报文就会丢弃**

1.调大 netdev_max_backlog

当网卡接收数据包的速度大于内核处理的速度时，会有一个队列用于保存这些数据包。我们可以调大这个队列的最大值

2.增大 TCP 半连接队列

增大三个参数：net.ipv4.tcp_max_syn_backlog， listen() 函数中的 backlog， net.core.somaxconn

3.开启 net.ipv4.tcp_syncookies

当半连接队列满了的时候，将接受的SYN报文，计算出一个cookie，然后将这个cookie值返回给客户端，当服务端接收到ACK时，会判断ACK包的合法性，如果合法就创建一个全连接队列

4.减少 SYN+ACK 重传次数

TCP 会重传 SYN+ACK ，当重传超过次数达到上限后，就会断开连接。我们可以减少重传的上限

5.防火墙设置

有时防火墙或者网络设备的设置会导致TCP连接建立失败。检查防火墙设置，确保允许了TCP连接建立所需要的端口和协议。

### 什么时SYN超时，如何解决SYN超时？

SYN超时(SYN TIMEOUT)：在TCP连接的建立阶段，客户端会发送一个SYN（同步）报文段到服务器，服务器接收到后会回复一个SYN-ACK（同步-确认）报文段，最后客户端再发送一个ACK（确认）报文段确认连接建立。如果在某个阶段出现超时，可能会导致连接建立失败。SYN超时可能会由于网络延迟，拥塞或网络故障等原因引起。

1.增加SYN超时时间：调整服务器的SYN超时时间，使其能够容忍更长的等待时间

2.优化网络连接：检查网络设备，链路和路由器等，确保网络的稳定性和低延迟

3.加强服务器性能：提升服务器的资源和处理能力，以应对更多的连接请求