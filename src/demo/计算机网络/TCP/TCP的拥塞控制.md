---
title: TCP的拥塞控制
date: 2023-11-28
tags:
 - 计算机基础
 - 计算机网络
 - TCP
categories:
 - 计算机网络
---

<!-- more -->

## 拥塞控制：

**避免「发送方」的数据填满整个网络**，为了在「发送方」调节所要发送数据的量，定义了一个叫做「**拥塞窗口**」的概念。
$$
什么是拥塞窗口，和发送窗口有什么关系？又是怎么知道当前网络出现了拥塞？拥塞控制有哪些？
$$
**拥塞窗口 cwnd**是发送方维护的一个的状态变量，它会根据**网络的拥塞程度动态变化的**。发送窗口的值是swnd = min(cwnd, rwnd)，

只要发生超时重传就会认为网络出现了拥塞

 ### 慢启动

  TCP在刚建立的时候，会一点一点提高发送数据包的数量，**当发送方每收到一个 ACK，拥塞窗口 cwnd 的大小就会加 1。**

  发包个数呈指数增长

  有一个叫慢启动门限 `ssthresh` （slow start threshold）状态变量。

  - 当 `cwnd` < `ssthresh` 时，使用慢启动算法。
  - 当 `cwnd` >= `ssthresh` 时，就会使用「拥塞避免算法」。

 ### 拥塞避免

  **每当收到一个 ACK 时，cwnd 增加 1/cwnd。**从指数增长变成线性增长

  当触发了重传机制，也就进入了「拥塞发生算法」。

 ### 拥塞发生

  当发生了「超时重传」，则就会使用拥塞发生算法。

  这个时候，ssthresh 和 cwnd 的值会发生变化：

  - `ssthresh` 设为 `cwnd/2`，
  - `cwnd` 重置为 `1` （是恢复为 cwnd 初始化值，我这里假定 cwnd 初始化值

  当发生「快速重传」的时候，TCP 认为这种情况不严重，因为大部分没丢，只丢了一小部分，则 `ssthresh` 和 `cwnd` 变化如下：

  - `cwnd = cwnd/2` ，也就是设置为原来的一半;
  - `ssthresh = cwnd`;
  - 进入快速恢复算法

 ### 快速恢复

  进入快速恢复算法如下：

- 拥塞窗口 `cwnd = ssthresh + 3` （ 3 的意思是确认有 3 个数据包被收到了）；

- 重传丢失的数据包；

- 如果再收到重复的 ACK，那么 cwnd 增加 1；目的是尽快将丢失的数据包发送给目标

- 如果收到新数据的 ACK 后，把 cwnd 设置为第一步中的 ssthresh 的值，原因是该 ACK 确认了新的数据，说明从 duplicated ACK 时的数据都已收到，该恢复过程已经结束，可以回到恢复之前的状态了，也即再次进入拥塞避免状态；