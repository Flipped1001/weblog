---
title: HTTPS如何优化
date: 2023-11-23
tags:
 - 计算机基础
 - 计算机网络
 - HTTPS
categories:
 - 计算机网络
---

<!-- more -->

# HTTPS如何优化？

## 1.分析性能损耗

- 第一个环节， TLS 协议握手过程；

- 第二个环节，握手后的对称加密报文传输。

  第一个环节的性能损耗更大一些

### 硬件优化

HTTPS协议是**计算密集型**，而不是**I/O密集型**，应该买CUP，应该选择可以**支持 AES-NI 特性的 CPU**

### 软件优化

软件的优化方向可以分成两种：**软件升级，协议优化**

- 软件升级存在一定风险
- 主攻协议优化：
  1. **密钥算法优化**：密钥交换算法尽量不要选择RSA密钥交换算法，而是选择ECDHE密钥交换算法，椭圆 **x25519 曲线**——不仅可以减少时间，还可以拥有前向安全性
  2. **TLS升级**：**TLS 1.3 把 Hello 和公钥交换这两个消息合并成了一个消息，于是这样就减少到只需 1 RTT 就能完成 TLS 握手**。只支持ECDHE算法

### 证书优化

对于证书的优化，可以有两个方向：

- 一个是**证书传输**，

- 一个是**证书验证**；

  

  1. 证书传输优化

  要让证书更便于传输，那必然是减少证书的大小，这样可以节约带宽，也能减少客户端的运算量。所以，**对于服务器的证书应该选择椭圆曲线（ECDSA）证书，而不是 RSA 证书，因为在相同安全强度下， ECC 密钥长度比 RSA 短的多**。

  2.证书传输优化

   OCSP ，名为在线证书状态协议（*Online Certificate Status Protocol*）来查询证书的有效性，它的工作方式是**向 CA 发送查询请求，让 CA 返回证书的有效状态**。

### 会话复用

- 第一种叫 Session ID；

- 第二种叫 Session Ticket；

  都不具备前向安全性

  1. Session ID：**客户端和服务器首次 TLS 握手连接后，双方会在内存缓存会话密钥，并用唯一的 Session ID 来标识**
     弊端：**客户端再次e连接不一定会命中上次访问过的服务器**，客户端增多，占用服务器的内存太多

  2. Session Ticket:服务端不在储存会话密钥，而是把缓存交给客户端

     

     TLS1.3:客户端会把 Ticket 和 HTTP 请求一同发送给服务端，这种方式叫 **Pre-shared Key**。


## **HTTPS中TCP三次握手和TLS握手能同时进行吗？**

如果客户端和服务端同时支持 TCP Fast Open 功能，那么在完成首次通信过程后，后续客户端与服务端 的通信则可以绕过三次握手发送数据，这就减少了握手带来的 1 个 RTT 的时间消耗。

在特定的， TCP Fast Open + TLSv1.3同时开启的情况下，并且是第二次进行通信，这样才可以跳过三次握手，直接进行TLS握手  