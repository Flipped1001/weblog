---
title: redis的切片集群模式
date: 2024-04-07
tags:
 - redis
categories:
 - redis
 - 切片集群
---

### 切片集群模式

当Redis的缓存数据量大到一台服务器无法缓存时，就需要使用**Redis切片集群**（Redis Cluster），他将数据分布在不同的服务器上，以此来降低系统对于单主节点的依赖，从而提高Redis服务的读写性能

Redis Cluster方案采用哈希槽（Hash Slot），来处理数据和节点之间的映射关系。在Redis Cluster方案中，一个切片集群共有16384个哈希槽。之后会根据Key来映射到对应的槽中

- 根据键值对的 key，按照`CRC16`算法计算一个16 bit的值
- 再用 16 bit 值对 16384 取模，得到 0~16383 范围内的模数，每个模数代表一个相应编号的哈希槽。

然后就是将槽映射到Redis上

- 平均分配: 在使用`cluster create` 命令创建 Redis 集群时，Redis 会自动把所有哈希槽平均分布到集群节点上。比如集群中有 9 个节点，则每个节点上槽的个数为 16384/9 个。
- 手动分配: 可以使用`cluster meet` 命令手动建立节点间的连接，组成集群，再使用 cluster addslots 命令，指定每个节点上的哈希槽个数。再手动分配的时候要将所有槽都分配完